package com.example.demo.repository;

import org.springframework.dao.EmptyResultDataAccessException;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import com.example.demo.model.User;
import com.example.demo.repository.rowmapper.UserRowMapper;

@Repository
public class UserRepository {
	private final JdbcTemplate jdbc;

    public UserRepository(JdbcTemplate jdbc) {
        this.jdbc = jdbc;
    }

    public User findByEmailOrPhone(String emailOrUsername) {
        String sql = """
            SELECT u.*, r.role_name
            FROM users u
            JOIN roles r ON u.role_id = r.role_id
            WHERE u.email = ? OR u.phone = ?
            """;
        try {
            return jdbc.queryForObject(sql, new UserRowMapper(),
                    emailOrUsername, emailOrUsername);
        } catch (EmptyResultDataAccessException e) {
            return null;
        }
    }

}
